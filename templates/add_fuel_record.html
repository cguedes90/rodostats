{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-gas-pump"></i> Novo Abastecimento - {{ vehicle.name }}
                    </h5>
                </div>
                <div class="card-body">
                    <form method="POST" enctype="multipart/form-data">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="date" class="form-label">Data</label>
                                    <input type="date" class="form-control" id="date" name="date" required 
                                           value="{{ current_date }}">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="odometer" class="form-label">Odômetro (km)</label>
                                    <input type="number" step="0.1" class="form-control" id="odometer" name="odometer" required>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="liters" class="form-label">Litros</label>
                                    <input type="number" step="0.01" class="form-control" id="liters" name="liters" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="price_per_liter" class="form-label">Preço por Litro (R$)</label>
                                    <input type="number" step="0.001" class="form-control" id="price_per_liter" name="price_per_liter" required>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="total_cost" class="form-label">Total (R$)</label>
                                    <input type="number" step="0.01" class="form-control" id="total_cost" name="total_cost" required readonly>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="fuel_type" class="form-label">Tipo de Combustível</label>
                                    <select class="form-control" id="fuel_type" name="fuel_type">
                                        <option value="gasoline" {% if vehicle.fuel_type == 'gasoline' %}selected{% endif %}>Gasolina</option>
                                        <option value="ethanol" {% if vehicle.fuel_type == 'ethanol' %}selected{% endif %}>Etanol</option>
                                        <option value="diesel" {% if vehicle.fuel_type == 'diesel' %}selected{% endif %}>Diesel</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="gas_station" class="form-label">Posto de Combustível</label>
                            <input type="text" class="form-control" id="gas_station" name="gas_station">
                        </div>

                        <div class="mb-3">
                            <label for="receipt_image" class="form-label">Foto da Nota Fiscal</label>
                            <input type="file" class="form-control" id="receipt_image" name="receipt_image" accept="image/*">
                            <small class="form-text text-muted">
                                Envie uma foto da nota fiscal para extração automática de dados com IA
                            </small>
                        </div>

                        <div class="mb-3">
                            <label for="notes" class="form-label">Observações</label>
                            <textarea class="form-control" id="notes" name="notes" rows="3"></textarea>
                        </div>

                        <div class="d-flex justify-content-between">
                            <a href="{{ url_for('vehicle_detail', vehicle_id=vehicle.id) }}" class="btn btn-secondary">
                                <i class="fas fa-arrow-left"></i> Voltar
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Salvar Abastecimento
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Calcular total automaticamente
document.getElementById('liters').addEventListener('input', calculateTotal);
document.getElementById('price_per_liter').addEventListener('input', calculateTotal);

function calculateTotal() {
    const liters = parseFloat(document.getElementById('liters').value) || 0;
    const pricePerLiter = parseFloat(document.getElementById('price_per_liter').value) || 0;
    const total = (liters * pricePerLiter).toFixed(2);
    document.getElementById('total_cost').value = total;
}
</script>
{% endblock %}
